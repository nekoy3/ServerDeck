# ServerDeck プロジェクト概要

## プロジェクト名
ServerDeck

## プロジェクトの目的
自宅サーバー群を管理するためのWebアプリケーション。

## 主要機能
- **UIでのサーバーアクセス**: 各サーバーへのアクセスをブラウザ上で可能にするUI。
- **動的なサーバー追加**: YAMLファイルなどを用いてサーバー情報を動的に追加・管理。
- **ブラウザ上でのSSH接続**: WebベースのSSHクライアント機能を提供。

## 技術スタック (提案)
- **バックエンド**: Python (Flask)
- **フロントエンド**: HTML, CSS, JavaScript (具体的なフレームワークは未定、必要に応じて検討)
- **サーバー管理**: YAMLによる設定、SSHにはParamikoを使用する可能性あり。

## 開発環境セットアップ

本プロジェクトの開発環境は、主にDockerコンテナを使用して構築されます。これにより、環境依存の問題を最小限に抑え、開発者間で一貫した環境を提供します。

1.  **Dockerのインストール**: Docker Desktop (またはDocker Engine) がシステムにインストールされていることを確認してください。
2.  **リポジトリのクローン**: `git clone [リポジトリURL]` でプロジェクトをローカルにクローンします。
3.  **Dockerコンテナの起動**: 「Dockerを使用した初期セットアップと実行」セクションの手順に従って、アプリケーションコンテナを起動します。

## ビルド、テスト、Lintコマンド

### ビルド

アプリケーションのビルドは、Dockerイメージのビルドによって行われます。詳細については、「Dockerを使用した初期セットアップと実行」セクションの「Dockerイメージのビルド」を参照してください。

### テスト
(後で追加)

### Lint
(後で追加)

## コーディング規約
(後で追加)

## 重要なファイル/ディレクトリ
- `app.py`: メインのFlaskアプリケーションファイル。
- `templates/`: HTMLテンプレート。
- `static/`: CSS, JavaScript, 画像ファイル。
- `config/servers.yaml`: サーバー設定ファイル。
- `Dockerfile`: Dockerコンテナのビルド定義ファイル。
- `requirements.txt`: Pythonの依存関係リスト。

## 一般的な開発ワークフロー

本プロジェクトでは、以下のGitワークフローに従って開発を進めます。詳細については「Gitワークフロー」セクションを参照してください。

## Gitワークフロー

本プロジェクトでは、`main`ブランチをメインの開発ブランチとして使用します。`master`ブランチは使用しません。

### コミットの手順

1.  **変更のステージング**: 作業ディレクトリでの変更をステージングエリアに追加します。
    ```bash
    git add <ファイル名> # 特定のファイルを追加
    git add .           # すべての変更を追加
    ```

2.  **変更のコミット**: ステージングされた変更をコミットします。コミットメッセージは、変更内容を簡潔かつ明確に記述してください。
    ```bash
    git commit -m "feat: 新機能の追加" # 新機能
    git commit -m "fix: バグ修正"     # バグ修正
    git commit -m "docs: ドキュメント更新" # ドキュメント更新
    ```

3.  **変更のプッシュ**: コミットした変更をリモートリポジトリの`main`ブランチにプッシュします。
    ```bash
    git push origin main
    ```

### 最新の変更の取得

リモートリポジトリの`main`ブランチから最新の変更を取得するには、以下のコマンドを使用します。

```bash
git pull origin main
```

### ブランチの作成と切り替え

新機能の開発やバグ修正を行う際は、`main`ブランチから新しいブランチを作成し、そのブランチで作業を進めることを推奨します。

1.  **新しいブランチの作成と切り替え**:
    ```bash
    git checkout -b feature/your-feature-name
    ```

2.  **ブランチの切り替え**:
    ```bash
    git checkout main
    ```

### リモートブランチの追跡設定の解除

もし、誤って`master`ブランチを追跡する設定になってしまった場合は、以下のコマンドで追跡設定を解除できます。

```bash
git branch --unset-upstream
```

## 既知の問題/注意事項
- SSH接続機能の実装にはセキュリティ面での考慮が重要。
- 動的なサーバー追加・管理の仕組みをどのように設計するかが鍵。

## Dockerを使用した初期セットアップと実行

リポジトリをクローンした後、Dockerを使用してServerDeckアプリケーションをセットアップし実行するには、以下の手順に従ってください。

1.  **プロジェクトディレクトリへ移動:**
    ```bash
    cd ServerDeck
    ```

2.  **Dockerイメージのビルド:**
    ```bash
    docker build -t serverdeck-app .
    ```
    このコマンドは、現在のディレクトリにある`Dockerfile`に基づいて`serverdeck-app`という名前のDockerイメージをビルドします。

3.  **Dockerコンテナの実行:**
    ```bash
    docker run -d -p 5001:5001 --name serverdeck-container serverdeck-app
    ```
    このコマンドは、`serverdeck-app`イメージをデタッチモード(`-d`)で実行し、ホストのポート5000をコンテナのポート5000にマッピング(`-p 5000:5000`)し、コンテナに`serverdeck-container`という名前を付けます。

    アプリケーションは通常、ブラウザで`http://127.0.0.1:5000/`からアクセスできます。

4.  **Dockerコンテナの停止 (完了時):**
    ```bash
    docker stop serverdeck-container
    ```

5.  **Dockerコンテナの削除 (不要になった場合):**
    ```bash
    docker rm serverdeck-container
    ```

## 最近の変更

### 設定ページをモーダル化

設定ページ (`/config`) がメインページ上のモーダルオーバーレイとして表示されるようになりました。
ナビゲーションバーの「Config」リンクをクリックすると、設定コンテンツがBootstrapモーダルに動的に読み込まれ、ページ全体のリロードなしでシームレスなユーザーエクスペリエンスを提供します。

**影響を受けるファイル:**
- `app.py`: `/config`ルートが`config_modal_content.html`をレンダリングするように変更されました。
- `templates/index.html`: Bootstrapモーダル構造が追加され、「Config」リンクがモーダルをトリガーするように更新されました。
- `templates/config_modal_content.html`: モーダルに読み込まれるように設計された、設定ページの実際のコンテンツを含む新しいファイルです。
- `static/js/script.js`: モーダルへの設定コンテンツの動的読み込みと、読み込まれたコンテンツのJavaScriptロジックの再初期化を処理するように更新されました。